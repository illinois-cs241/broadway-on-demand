<script type="application/javascript">
    function updateButtonContent(runId, text, buttonType) {
        $("#status-" + runId).html("<i class=\"fas fa-sync-alt\"></i> " + text)
                             .attr("class", "btn btn-secondary btn-sm " + buttonType);
    }

    function getRunStatus(runId) {
        $.ajax(
            {
                url: "./" + runId + "/status/",
                success: function (result) {
                    var status_map = {
                        "scheduled": "btn-info",
                        "running": "btn-info",
                        "success": "btn-success",
                        "failed": "btn-danger",
                        "": "btn-info"
                    };

                    for (var key in status_map) {
                        if (result.indexOf(key) != -1) {
                            if (key == "scheduled") {
                                getQueuePosition(runId);
                            } else {
                                updateButtonContent(runId, result, status_map[key]);
                            }
                            break;
                        }
                    }
                },
                error: function () {
                    updateButtonContent(runId, "Unknown. Click to try again.", "btn-warning");
                }
            })
    }

    function getQueuePosition(runId) {
        $.ajax(
            {
                url: "./" + runId + "/position/",
                success: function (result) {
                    let queuePositionString = "Your job is scheduled after " + result + " other jobs";
                    if (result == "0") {
                        queuePositionString = "Your job is next";
                    }
                    updateButtonContent(runId, queuePositionString, "btn-info");
                },
                error: function () {
                    updateButtonContent(runId, "Your run is scheduled. Queue position unknown.", "btn-info");
                }
            })
    }
</script>
